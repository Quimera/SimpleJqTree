(function(c){function b(e,f){var d={};c.each(e,function(){d[this]=f[e[this]]});return d}function a(h,g){var e=this,f=h.add(e),d=g.json_attr;h.addClass("tree");c.extend(e,{markup:function(i){var k=i,l='<img class="dummy" alt="icon" src="data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==">',j=k.find("li").prepend(l);e.items=k.find("a").prepend(c(l).addClass("icon"));j.each(function(){var m=c(this).find("> ul").addClass("container");if(m[0]){c(this).addClass("folderish").children("img").addClass("arrow")}})},build_from_JSON:function(k){var j=c('<ul class="root container"><ul/>'),i=[];i.push(c(k));while(i[0]){currentnode=i.shift();c.each(currentnode,function(l,m){attr=b(d,m);li=c('<li><a href="#">'+this.title+"</a></li>");li.find("> a").addClass(m.metatype).attr(attr);j.append(li);if(m.children){j=j.find("li:last").append("<ul/>").find("> ul");i.push(m.children)}else{if(m.folderish){j.find("li:last").append("<ul/>").find("> ul").addClass("container")}}})}j=j.hasClass("root")?j:j.parents(".root");return j},click:function(l){var k=c(l.currentTarget),i=k.siblings(".container"),j=k.parent(".folderish");if(i[0]){if(i.html()===""&&g.ajax_handler){e.ajax_call(k,j)}else{e.slide(i)}}else{g.action_handler(k)}},slide:function(i){var j=i.parent(".folderish");if(i.css("display")=="none"){i.slideDown("fast",function(){j.addClass("opened")})}else{i.slideUp("fast",function(){j.removeClass("opened")})}},ajax_call:function(i,k){if(c.isFunction(g.ajax_handler.data)||g.ajax_handler.data_back){g.ajax_handler.data_back=g.ajax_handler.data_back?g.ajax_handler.data_back:g.ajax_handler.data;g.ajax_handler.data=g.ajax_handler.data_back(i)}var j=c.extend(g.ajax_handler,{dataType:"json",success:function(m){var l=e.build_from_JSON(m);c(k).find("> ul").remove();k.append(l);l.simplejqtree(g);e.slide(l)}});c.ajax(j)}});e.markup(h);e.items.each(function(){var i=c(this);i.bind("click.simplejqtree",function(j){e.click(j);return j.preventDefault()});i.siblings(".arrow").click(function(){i.trigger("click.simplejqtree")})})}c.fn.simplejqtree=function(d){var f=this.data("simplejqtree");if(f){return f}var e={ajax_handler:{},action_handler:{},json_attr:{id:"id",href:"href",rel:"rel"}};if(d){c.extend(e,d)}return this.each(function(){f=new a(c(this),e);c(this).data("simplejqtree",f)})}})(jQuery);
